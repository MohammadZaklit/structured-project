<div class="h-screen flex bg-gray-100 text-sm gap-4">
  <aside class="w-72 bg-white border-r border-gray-200 p-4 overflow-y-auto">
    <nz-typography [config]="leftHeading"></nz-typography>
    <div
      class="form-field-palette space-y-2"
      [dragula]="bagFieldsName"
      [dragulaModel]="availableFields"
    >
      @for (field of availableFields; track field) {
        <div
          class="flex items-center gap-2 p-3 bg-gray-50 border border-gray-200 rounded-lg cursor-move hover:bg-gray-100 hover:shadow-sm transition component-item draggable-field is-draggable main-field"
          [attr.data-component-type]="field.type"
        >
          <i class="pi pi-bars mr-2 text-gray-400"></i>
          <span class="font-medium">{{ field.label }}</span>
        </div>
      }
    </div>
  </aside>

  <main class="flex-auto overflow-auto">
    <nz-typography [config]="middleHeading"></nz-typography>
    <!-- <button class="btn btn-success mb-3 ml-2" (click)="submitForm()">Submit Form</button> -->
    <div
      class="max-w-3xl min-h-[500px] bg-white border-2 border-dashed border-gray-300 rounded-xl transition is-droppable {{
        mainDroppableAreaName
      }}"
      [class.border-blue-400]="isDragging"
      [class.bg-blue-50]="isDragging"
      [dragula]="bagFieldsName"
      [dragulaModel]="droppedRows"
    >
      @if (droppedRows.length === 0) {
        <div class="text-gray-400 text-center">Drag a **Row** here to begin!</div>
      }

      <ng-template #renderRowTemplate let-components="components">
        @for (component of components; track component.id; let rIndex = $index) {
          <div
            class="p-2 m-2 bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition is-draggable component-item"
            id="{{ component.type }}-{{ component.id }}"
            [attr.data-component-id]="component.id"
            [attr.data-component-type]="component.type"
            [attr.data-component-index]="rIndex"
          >
            <div class="drag-handle cursor-move">â‡…</div>
            <div class="flex items-center justify-between px-3 py-2">
              <span class="font-medium">{{ component.label }}</span>
              <!-- <i
                class="pi pi-ellipsis-v text-gray-400 drag-handle cursor-move"
                
              ></i> -->
            </div>
            @if (component.childComponents.length > 0) {
              <ng-container
                *ngTemplateOutlet="
                  renderRowTemplate;
                  context: {
                    components: component.childComponents,
                  }
                "
              ></ng-container>
            }
            @if (
              component.type === componentTypeEnum.Row ||
              component.type === componentTypeEnum.Column
            ) {
              <div
                class="is-droppable min-h-10 flex flex-col"
                [attr.data-component-id]="component.id"
                [attr.data-component-type]="component.type"
                [attr.data-component-index]="rIndex"
                [dragula]="bagFieldsName"
                [dragulaModel]="component.childComponents"
                [ngClass]="{
                  'align-center justify-center': component.childComponents.length === 0,
                }"
              >
                <!-- @if (
                  component.type === componentTypeEnum.Row && component.childComponents.length === 0
                ) {
                  <span class="text-gray-400">
                    Drag a **Column** from the left side components.
                  </span>
                } @else if (
                  component.type === componentTypeEnum.Column &&
                  component.childComponents.length === 0
                ) {
                  <span class="text-gray-400">
                    Drag a **Field** or **Row** from the left side components.
                  </span>
                } -->
              </div>
            }
          </div>
        }
      </ng-template>
      <ng-container
        *ngTemplateOutlet="renderRowTemplate; context: { components: droppedRows }"
      ></ng-container>
    </div>
  </main>

  <aside
    class="right-sidebar w-80 bg-white border-l border-gray-200 p-4 overflow-y-auto"
    [hidden]="!componentConfig"
  >
    <nz-typography [config]="customizeHeading"></nz-typography>
    @if (componentConfig) {
      <div class="text-gray-400 text-center mt-20">
        <nz-component-configuration
          (cancel)="closeSettings()"
          (save)="saveField($event)"
          [config]="componentConfig"
        ></nz-component-configuration>
      </div>
    }
  </aside>
</div>
