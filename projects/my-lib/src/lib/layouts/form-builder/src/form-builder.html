<div class="h-screen flex bg-gray-100 text-sm gap-4">
  <aside class="w-72 bg-white border-r border-gray-200 p-4 overflow-y-auto">
    <nz-typography [config]="leftHeading"></nz-typography>
    <div
      class="form-field-palette space-y-2"
      cdkDropList
      [id]="toolBoxContainerId"
      #toolbox="cdkDropList"
      [cdkDropListConnectedTo]="connectedList"
      [cdkDropListData]="availableFields"
    >
      @for (field of availableFields; track field.type) {
        <div
          cdkDrag
          [cdkDragData]="field"
          class="flex items-center gap-2 p-3 bg-gray-50 border border-gray-200 rounded-lg cursor-move hover:bg-gray-100 hover:shadow-sm transition component-item draggable-field is-draggable main-field"
          [attr.data-component-type]="field.type"
        >
          <i class="pi pi-bars mr-2 text-gray-400"></i>
          <span class="font-medium">{{ field.label }}</span>
        </div>
      }
    </div>
  </aside>

  <main class="flex-auto overflow-auto">
    <nz-typography [config]="middleHeading"></nz-typography>
    <ng-template
      #renderRowTemplate
      let-canvascomponents="canvascomponents"
      let-parentitem="parentitem"
    >
      <div
        class="max-w-3xl bg-white border-2 border-dashed border-gray-300 rounded-xl transition"
        [class.border-blue-400]="isDragging"
        [class.bg-blue-50]="isDragging"
        [ngClass]="!parentitem ? 'min-h-[500px]' : ''"
        cdkDropList
        [cdkDropListData]="canvascomponents"
        (cdkDropListDropped)="dropItem($event)"
        [cdkDropListConnectedTo]="connectedList"
        [id]="parentitem ? parentitem.rowid : canvasContainerId"
      >
        @for (component of canvascomponents; track component.rowid; let rIndex = $index) {
          <div
            class="p-2 m-2 bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition is-draggable component-item"
          >
            <div
              [id]="component.rowid"
              [attr.data-component-id]="component.rowid"
              [attr.data-component-type]="component.type"
              [attr.data-component-index]="rIndex"
              cdkDrag
              [cdkDragData]="component"
            >
              <i cdkDragHandle class="pi pi-ellipsis-v text-gray-400 cursor-move"></i>
              <div class="flex items-center justify-between px-3 py-2">
                <span class="font-medium">{{ component.label }} - {{ component.rowid }}</span>
                <a (click)="selectField(component)">edit</a>
                <a (click)="removeComponent(component)">X</a>
              </div>
            </div>

            <div
              class="is-droppable min-h-10 flex flex-col"
              [attr.data-component-id]="component.rowid"
              [attr.data-component-type]="component.type"
              [attr.data-component-index]="rIndex"
              cdkDropList
              [id]="component.rowid"
              [cdkDropListData]="component.childComponents"
              [cdkDropListConnectedTo]="connectedListsIds(component.rowid)"
              (cdkDropListDropped)="dropItem($event)"
              [ngClass]="{
                'align-center justify-center': component.childComponents.length === 0,
              }"
            >
              @if (component.childComponents.length > 0) {
                <ng-container
                  *ngTemplateOutlet="
                    renderRowTemplate;
                    context: {
                      parentitem: component,
                      canvascomponents: component.childComponents,
                    }
                  "
                ></ng-container>
              }
            </div>
          </div>
        }
      </div>
    </ng-template>
    <ng-container
      *ngTemplateOutlet="
        renderRowTemplate;
        context: { parentitem: undefined, canvascomponents: droppedRows }
      "
    ></ng-container>
  </main>

  <aside
    class="right-sidebar w-80 bg-white border-l border-gray-200 p-4 overflow-y-auto"
    [hidden]="!componentConfig"
  >
    <nz-typography [config]="customizeHeading"></nz-typography>
    @if (componentConfig) {
      <div class="text-gray-400 text-center mt-20">
        <nz-component-configuration
          (cancel)="closeSettings()"
          (save)="saveField($event)"
          [config]="componentConfig"
        ></nz-component-configuration>
      </div>
    }
  </aside>
</div>
