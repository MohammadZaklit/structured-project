<div class="container-fluid">
  <div class="row">
    <div class="col-md-3 bg-light p-3 border-right">
      <h4>Form Components</h4>
      <div class="form-field-palette" [dragula]="bagFieldsName" [dragulaModel]="availableFields">
        @for (field of availableFields; track field.id) {
          <div
            class="card mb-2 p-2 draggable-field is-draggable main-field"
            [attr.data-component-type]="field.type"
          >
            {{ field.label }}
          </div>
        }
      </div>
    </div>

    <div class="col-md-6 p-3 border-right">
      <h4>Form Builder</h4>
      <button class="btn btn-success mb-3 ml-2" (click)="submitForm()">Submit Form</button>

      <div
        class="form-preview-area is-droppable {{ mainDroppableAreaName }}"
        [dragula]="bagFieldsName"
        [dragulaModel]="droppedRows"
      >
        @if (droppedRows.length === 0) {
          <div class="alert alert-info">Drag a **Row** here to begin!</div>
        }
        <ng-template #renderRowTemplate let-components="components">
          @for (component of components; track component.id; let rIndex = $index) {
            <div
              class="mb-3 p-2 border rounded bg-white is-draggable component-item"
              [attr.data-component-id]="component.id"
              [attr.data-component-type]="component.type"
              [attr.data-component-index]="rIndex"
            >
              <div>
                {{ component.label }}
                <i class="pi pi-arrows-alt text-2xl text-muted-color drag-handler"></i>
              </div>

              @if (component.childComponents.length > 0) {
                <ng-container
                  *ngTemplateOutlet="
                    renderRowTemplate;
                    context: {
                      components: component.childComponents,
                    }
                  "
                ></ng-container>
              }

              @if (
                component.type === componentTypeEnum.Row ||
                component.type === componentTypeEnum.Column
              ) {
                <div
                  class="is-droppable"
                  [attr.data-component-id]="component.id"
                  [attr.data-component-type]="component.type"
                  [attr.data-component-index]="rIndex"
                  [dragula]="bagFieldsName"
                  [dragulaModel]="component.childComponents"
                >
                  @if (
                    component.type === componentTypeEnum.Row &&
                    component.childComponents.length === 0
                  ) {
                    <div class="alert alert-warning text-center">
                      <p class="mb-0">Drag a **Column** from the left side components.</p>
                    </div>
                  } @else if (
                    component.type === componentTypeEnum.Column &&
                    component.childComponents.length === 0
                  ) {
                    <div class="alert alert-warning text-center">
                      <p class="mb-0">Drag a **Field** or **Row** from the left side components.</p>
                    </div>
                  }
                </div>
              }
            </div>
          }
        </ng-template>
        <ng-container
          *ngTemplateOutlet="renderRowTemplate; context: { components: droppedRows }"
        ></ng-container>
      </div>
    </div>

    <div class="col-md-3 bg-light p-3 border-left">
      <h4>Field Settings</h4>
      @if (componentConfig) {
        <div class="customization-pane p-3 bg-white border rounded">
          <!-- <h5>Edit: {{ selectedField!.label }}</h5> -->

          <nz-component-configuration
            (cancel)="closeSettings()"
            (save)="saveField($event)"
            [config]="componentConfig"
          ></nz-component-configuration>
        </div>
      } @else {
        <div class="alert alert-info">Select a field from the middle container to customize.</div>
      }
    </div>
  </div>
</div>
