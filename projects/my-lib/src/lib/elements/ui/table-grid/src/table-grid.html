<p-table
  #dt
  [value]="tableData()"
  [paginator]="config()?.paginator ?? false"
  [rows]="config()?.rows ?? 10"
  [showCurrentPageReport]="config()?.showCurrentPageReport ?? true"
  [rowsPerPageOptions]="config()?.rowsPerPageOptions ?? [10, 25, 50]"
  [reorderableRows]="true"
  (onRowReorder)="onRowReorder.emit($event)"
  [selectionMode]="
    (config()?.rowSelection ?? '') === 'none' ? undefined : config()?.rowSelection ?? ''
  "
  [(selection)]="selectedRows"
  dataKey="id"
  [lazy]="true"
  (onLazyLoad)="onLazyLoad($event)"
  [globalFilterFields]="config()!.columns.map(c => c.name) || []"
  (onSort)="onColumnSort.emit($event)"
>
  <ng-template pTemplate="header">
    <tr>
      @if (config()?.rowSelection !== 'none' && config()?.rowSelection === 'multiple') {
      <th style="width: 3rem">
        <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
      </th>
      } @if (config()?.sortableRows) {
      <th style="width: 3rem"></th>
      } @for (col of config()?.columns; track col.name) {
      <th
        [pSortableColumn]="
          (config()?.enableColumnSorting || false) && col.sortable !== false ? col.name : null
        "
      >
        {{ col.label }}
        @if (config()?.enableColumnSorting && col.sortable !== false) {
        <p-sortIcon [field]="col.name"></p-sortIcon>
        }
      </th>
      } @if ((config()?.enableStaticActions || false) || (config()?.dynamicActions || [])?.length >
      0) {
      <th>Actions</th>
      }
    </tr>
    @if (shouldApplyFilter()) {
    <tr>
      @if (config()?.rowSelection !== 'none' && config()?.rowSelection === 'multiple') {
      <th></th>
      } @if (config()?.sortableRows) {
      <th></th>
      } @for (col of config()?.columns; track col.name) {
      <th>
        @if (col.filter) {
        <input
          pInputText
          type="text"
          (input)="dt.filter($event.target.value, col.name, 'contains')"
          [placeholder]="'Search ' + col.label"
          class="w-full"
        />
        }
      </th>
      } @if ((config()?.enableStaticActions || false) || (config()?.dynamicActions || [])?.length >
      0) {
      <th></th>
      }
    </tr>
    }
  </ng-template>
  <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex">
    <tr [pSelectableRow]="rowData" [pReorderableRow]="rowIndex">
      @if (config()?.rowSelection !== 'none' && config()?.rowSelection === 'multiple') {
      <td>
        <p-tableCheckbox [value]="rowData"></p-tableCheckbox>
      </td>
      } @if (config()?.sortableRows) {
      <td>
        <i class="pi pi-bars" pReorderableRowHandle></i>
      </td>
      } @for (col of config()?.columns; track col.name) {
      <td>
        @switch (col.type) { @case ('date') {
        {{ rowData[col.name] | date : 'shortDate' }}
        } @case ('number') {
        {{ rowData[col.name] | number }}
        } @case ('long-string') {
        <span [pTooltip]="rowData[col.name]" tooltipPosition="bottom">
          {{ (rowData[col.name] | slice : 0 : 50) + (rowData[col.name].length > 50 ? '...' : '') }}
        </span>
        } @default {
        {{ rowData[col.name] }}
        } }
      </td>
      } @if ((config()?.enableStaticActions || false) || (config()?.dynamicActions || [])?.length >
      0) {
      <td>
        <div class="flex gap-2">
          @if (config()?.enableStaticActions?.edit) {
          <p-button
            icon="pi pi-pencil"
            styleClass="p-button-sm p-button-info"
            (onClick)="onEdit.emit(rowData)"
            pTooltip="Edit"
            tooltipPosition="bottom"
          ></p-button>
          } @if (config()?.enableStaticActions?.view) {
          <p-button
            icon="pi pi-eye"
            styleClass="p-button-sm p-button-secondary"
            (onClick)="onView.emit(rowData)"
            pTooltip="View"
            tooltipPosition="bottom"
          ></p-button>
          } @if (config()?.enableStaticActions?.delete) {
          <p-button
            icon="pi pi-trash"
            styleClass="p-button-sm p-button-danger"
            (onClick)="onDelete.emit(rowData)"
            pTooltip="Delete"
            tooltipPosition="bottom"
          ></p-button>
          } @for (action of config()?.dynamicActions; track action.label) { @if (!action.visible ||
          action.visible(rowData)) {
          <p-button
            [icon]="action.icon || ''"
            [label]="action.label"
            (onClick)="action.onclick(rowData)"
            [styleClass]="'p-button-sm ' + (action.styleClass || '')"
            [pTooltip]="action.tooltip || action.label"
            tooltipPosition="bottom"
            [disabled]="action.disabled && action.disabled(rowData)"
          ></p-button>
          } }
        </div>
      </td>
      }
    </tr>
  </ng-template>
  <ng-template pTemplate="emptymessage">
    <tr>
      <td [attr.colspan]="getColspan()">No records found.</td>
    </tr>
  </ng-template>
  <ng-template pTemplate="summary">
    @if (config()?.rowSelection !== 'none' && selectedRows.length > 0) {
    <div class="flex align-items-center justify-content-end">
      In total there are {{ tableData().length }} records. Selected: {{ selectedRows.length }}
    </div>
    } @else {
    <div class="flex align-items-center justify-content-end">
      In total there are {{ tableData().length }} records.
    </div>
    }
  </ng-template>
</p-table>
