<div class="container-fluid py-4">
  <div class="row mb-4">
    <div class="col"><h2>Modules Management</h2></div>
    <div class="col-auto"><button pButton label="Add Module" icon="pi pi-plus" class="p-button-success" (click)="showAddDialog()"></button></div>
  </div>
  <div class="row mb-3"><div class="col"><div class="card"><div class="row g-3">
    <div class="col-md-4"><label>Filter by Project</label>
      <p-select [options]="projects" [(ngModel)]="filterProjectId" optionLabel="name" optionValue="id" [filter]="true" placeholder="Select project" [showClear]="true" styleClass="w-100"></p-select>
    </div>
    <div class="col-md-4"><label>Filter by Name</label><input pInputText [(ngModel)]="filterName" placeholder="Search" class="w-100"/></div>
    <div class="col-md-4" style="align-self: end;">
      <button pButton label="Apply" icon="pi pi-filter" (click)="applyFilters()"></button>
      <button pButton label="Clear" icon="pi pi-times" class="p-button-outlined ms-2" (click)="clearFilters()"></button>
    </div>
  </div></div></div></div>
  <div class="row"><div class="col"><div class="card">
    <p-table [value]="modules" [loading]="loading" styleClass="p-datatable-gridlines" [paginator]="true" [rows]="10" [reorderableColumns]="true" (onRowReorder)="onRowReorder($event)">
      <ng-template pTemplate="header">
        <tr><th style="width:3rem"></th><th pSortableColumn="name">Name <p-sortIcon field="name"></p-sortIcon></th>
          <th>Path</th><th>Project</th><th>Order</th><th style="width:150px">Actions</th></tr>
      </ng-template>
      <ng-template pTemplate="body" let-module let-index="rowIndex">
        <tr [pReorderableRow]="index">
          <td><span class="pi pi-bars" pReorderableRowHandle></span></td>
          <td>{{module.name}}</td><td>{{module.path}}</td><td>{{module.project?.name}}</td><td>{{module.menu_order}}</td>
          <td>
            <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-text p-button-info" (click)="showEditDialog(module)" pTooltip="Edit"></button>
            <button pButton icon="pi pi-trash" class="p-button-rounded p-button-text p-button-danger" (click)="confirmDelete(module)" pTooltip="Delete"></button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage"><tr><td colspan="6" class="text-center py-4">No modules</td></tr></ng-template>
    </p-table>
  </div></div></div>
</div>

<p-dialog [(visible)]="displayDialog" [header]="isEditMode ? 'Edit Module' : 'Add Module'" [modal]="true" [style]="{width:'600px'}">
  <div class="p-fluid">
    <div class="field mb-3"><label>Name *</label><input pInputText [(ngModel)]="module.name" placeholder="Module name" class="w-100"/></div>
    <div class="field mb-3"><label>Path *</label><input pInputText [(ngModel)]="module.path" placeholder="/path" class="w-100"/></div>
    <div class="field mb-3"><label>Project *</label>
      <p-select [options]="projects" [(ngModel)]="module.project_id" optionLabel="name" optionValue="id" [filter]="true" placeholder="Select" styleClass="w-100"></p-select>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <button pButton label="Cancel" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></button>
    <button pButton label="Save" icon="pi pi-check" (click)="saveModule()" [disabled]="!module.name.trim()||!module.path.trim()||!module.project_id"></button>
  </ng-template>
</p-dialog>
<p-toast></p-toast><p-confirmDialog></p-confirmDialog>
